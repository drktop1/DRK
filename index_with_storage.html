
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>موقع دردشة نصي</title>
<style>
  body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; background: #f0f0f0;}
  #login, #communities, #chat { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
  #messages { border: 1px solid #ddd; height: 300px; overflow-y: scroll; padding: 10px; background: #fafafa; margin-bottom: 10px; }
  #users { border: 1px solid #ddd; height: 100px; overflow-y: auto; background: #eee; padding: 10px; margin-bottom: 10px; }
  input, select, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
  .message { margin: 5px 0; }
  .message strong { color: #007bff; }
</style>
</head>
<body>

<div id="login">
  <h2>تسجيل حساب</h2>
  <input type="text" id="username" placeholder="اسم المستخدم" />
  <button onclick="login()">تسجيل</button>
</div>

<div id="communities" style="display:none;">
  <h2>اختر مجتمع للانضمام</h2>
  <select id="communitySelect">
    <option value="general">عام</option>
    <option value="gaming">الألعاب</option>
    <option value="programming">البرمجة</option>
  </select>
  <button onclick="joinCommunity()">انضمام</button>
</div>

<div id="chat" style="display:none;">
  <h2>الدردشة في مجتمع: <span id="currentCommunity"></span></h2>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="اكتب رسالة..." />
  <button onclick="sendMessage()">إرسال</button>

  <h3>الأعضاء المتصلين</h3>
  <div id="users"></div>
</div>

<script>
  let currentUser = null;
  let currentCommunity = null;
  let messages = JSON.parse(localStorage.getItem("messages") || "{}");
  let users = {};

  function login() {
    const username = document.getElementById('username').value.trim();
    if (!username) {
      alert('يرجى إدخال اسم مستخدم');
      return;
    }
    currentUser = username;
    document.getElementById('login').style.display = 'none';
    document.getElementById('communities').style.display = 'block';
  }

  function joinCommunity() {
    currentCommunity = document.getElementById('communitySelect').value;
    document.getElementById('communities').style.display = 'none';
    document.getElementById('chat').style.display = 'block';
    document.getElementById('currentCommunity').innerText = currentCommunity;

    messages[currentCommunity] = messages[currentCommunity] || [];
    users[currentCommunity] = users[currentCommunity] || new Set();

    users[currentCommunity].add(currentUser);

    refreshUsers();
    refreshMessages();
  }

  function sendMessage() {
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if (!text) return;

    const msgObj = { user: currentUser, text: text };
    messages[currentCommunity].push(msgObj);
    input.value = '';
    localStorage.setItem("messages", JSON.stringify(messages));
    refreshMessages();
  }

  function refreshMessages() {
    const container = document.getElementById('messages');
    container.innerHTML = '';
    for (const msg of messages[currentCommunity]) {
      const div = document.createElement('div');
      div.className = 'message';
      div.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
      container.appendChild(div);
    }
    container.scrollTop = container.scrollHeight;
  }

  function refreshUsers() {
    const usersDiv = document.getElementById('users');
    usersDiv.innerHTML = '';
    for (const user of users[currentCommunity]) {
      const div = document.createElement('div');
      div.textContent = user;
      usersDiv.appendChild(div);
    }
  }
</script>

</body>
</html>
